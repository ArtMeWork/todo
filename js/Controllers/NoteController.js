define(["Models/Notes","Controllers/NotifyController","Views/NotesView"],function(e,t,n){function i(){window.app={"delete":function(r){var i=e.del(r);i.success?(n.update([{name:"delete",val:{id:r,count:e.get().length}}]),t.success("Заметка успешно удалена!")):t.err(i.error?i.error:"Нет сообщения")}},n.render(u()),r=setInterval(function(){n.update([{name:"time",val:u()}])},1e4)}function s(){clearInterval(r)}function o(e){var t=new Date,n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));n.setUTCHours(n.getUTCHours()+n.getTimezoneOffset()/60);var r=new Date(t-(n-e)),i=Math.floor((n-e)/1e3),s=0,o=[],u=["янв","фев","мар","апр","мая","июн","июл","авг","сен","окт","ноя","дек"],a=r.getDate()+" "+u[r.getMonth()]+" "+r.getFullYear()+", в "+r.getHours()+":"+r.getMinutes();return i<60?(s=i,o=["только что","секунд назад","секунду назад","секунды назад"],{text:(s>=10?s:"")+" "+o[s<10?0:s>=10&&s<=20?1:s%10==1?2:s%10>1&&s%10<5?3:1],date:a}):i>=60&&i<3600?(s=Math.floor(i/60),o=["минуту назад","две минуты назад","три минуты назад","минут назад","минуту назад","минуты назад"],{text:(s>3?s:"")+" "+o[s<4?s-1:s>4&&s<=20?3:s%10==1?4:s%10>1&&s%10<5?5:3],date:a}):i>=3600&&i<21600?(s=Math.floor(i/60/60),o=["час назад","два часа назад","три часа назад","часа назад","часов назад"],{text:(s>3?s:"")+" "+o[s<4?s-1:s>4&&s<=20?4:s%10==1?0:s%10>1&&s%10<5?3:4],date:a}):i>2160&&t.getDate()-r.getDate()===0?{text:"сегодня в "+r.getHours()+":"+r.getMinutes(),date:a}:t.getDate()-r.getDate()===1?{text:"вчера в "+r.getHours()+":"+r.getMinutes(),date:a}:a}function u(){return e.get().forEach(function(e){e.up_time=o(e.date)}),e.get()}var r;return{start:i,stop:s}});